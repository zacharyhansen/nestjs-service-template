{"version":3,"sources":["../../src/command/post-migrate.ts"],"sourcesContent":["import { NestFactory } from '@nestjs/core';\n\nimport { AppModule } from '../app';\nimport { ViewService } from '../view/view.service';\n\nimport type { TDatabase } from '~/database/database';\n\nconst CLIENT_SCHEMAS: TDatabase['configuration.view']['schema'][] = [\n  'foundation',\n];\n\nasync function bootstrap() {\n  const app = await NestFactory.createApplicationContext(AppModule);\n  const viewMetadataService = app.get(ViewService);\n\n  try {\n    await viewMetadataService.syncViews({ schemas: CLIENT_SCHEMAS });\n    console.log('View metadata sync completed successfully');\n  } catch (error) {\n    console.error('Error during view metadata sync:', error);\n    throw error;\n  } finally {\n    await app.close();\n  }\n}\n\nbootstrap().catch((error: unknown) => {\n  console.error('Migration failed:', error);\n  // eslint-disable-next-line unicorn/no-process-exit\n  process.exit(1);\n});\n"],"names":["NestFactory","AppModule","ViewService","CLIENT_SCHEMAS","bootstrap","app","createApplicationContext","viewMetadataService","get","syncViews","schemas","console","log","error","close","catch","process","exit"],"mappings":"AAAA,SAASA,WAAW,QAAQ,eAAe;AAE3C,SAASC,SAAS,QAAQ,kBAAS;AACnC,SAASC,WAAW,QAAQ,0BAAuB;AAInD,MAAMC,iBAA8D;IAClE;CACD;AAED,eAAeC;IACb,MAAMC,MAAM,MAAML,YAAYM,wBAAwB,CAACL;IACvD,MAAMM,sBAAsBF,IAAIG,GAAG,CAACN;IAEpC,IAAI;QACF,MAAMK,oBAAoBE,SAAS,CAAC;YAAEC,SAASP;QAAe;QAC9DQ,QAAQC,GAAG,CAAC;IACd,EAAE,OAAOC,OAAO;QACdF,QAAQE,KAAK,CAAC,oCAAoCA;QAClD,MAAMA;IACR,SAAU;QACR,MAAMR,IAAIS,KAAK;IACjB;AACF;AAEAV,YAAYW,KAAK,CAAC,CAACF;IACjBF,QAAQE,KAAK,CAAC,qBAAqBA;IACnC,mDAAmD;IACnDG,QAAQC,IAAI,CAAC;AACf"}