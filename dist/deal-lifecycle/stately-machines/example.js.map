{"version":3,"sources":["../../../src/deal-lifecycle/stately-machines/example.ts"],"sourcesContent":["import { setup, assign, createMachine } from 'xstate';\n\nexport const machine = setup({\n  types: {\n    context: {} as { error?: string; deal_id: number },\n    events: {} as\n      | { type: 'user.price' }\n      | { type: 'user.cancel' }\n      | { type: 'user.submit' }\n      | { type: 'user.archive' }\n      | { type: 'system.submit' }\n      | { type: 'system.completed' }\n      | { type: 'user.approve_price' }\n      | { type: 'user.funding_recieved' }\n      | { type: 'user.contract_recieved' }\n      | { type: 'user.contract_verified' }\n      | { type: 'system.contract_recieved' }\n      | { type: 'user.underwriting_approved' }\n      | { type: 'user.underwriting_completed' },\n  },\n  actions: {\n    sendEmail: function ({ context, event }, params) {\n      // Add your action code here\n      // ...\n    },\n    createTask: function ({ context, event }, params) {\n      // Add your action code here\n    },\n    assign: assign({\n      // ...\n    }),\n  },\n  actors: {\n    validator: createMachine({\n      /* ... */\n    }),\n  },\n}).createMachine({\n  context: {\n    error: '',\n    deal_id: 1,\n  },\n  id: 'lifecycle',\n  initial: 'submission',\n  description:\n    'Represents the lifecycle of a deal of an opportunity. It is important to remember that an opportunities status is just the status of the active deal within the opportunity - in this way this is effectively a lifecycle for the opportunity as well. The active deal can be swapped out to different one to \"move\" an opportunity forward or backward in state.',\n  states: {\n    submission: {\n      on: {\n        'user.submit': {\n          target: 'submission_validation',\n        },\n        'system.submit': {\n          target: 'submission_validation',\n        },\n        'user.archive': {\n          target: 'archived',\n        },\n      },\n    },\n    submission_validation: {\n      invoke: {\n        id: 'submission_validator',\n        input: {\n          deal_id: 'context.deal_id',\n        },\n        onDone: {\n          target: 'pre_qualified',\n          actions: [\n            {\n              type: 'createTask',\n            },\n            {\n              type: 'sendEmail',\n            },\n          ],\n        },\n        onError: {\n          target: 'failed_pre_qualification',\n        },\n        src: 'validator',\n      },\n    },\n    archived: {},\n    pre_qualified: {\n      on: {\n        'user.price': {\n          target: 'pricing',\n        },\n        'user.archive': {\n          target: 'archived',\n        },\n      },\n    },\n    failed_pre_qualification: {\n      on: {\n        'user.submit': {\n          target: 'submission_validation',\n        },\n        'user.archive': {\n          target: 'archived',\n        },\n      },\n    },\n    pricing: {\n      on: {\n        'user.approve_price': {\n          target: 'pricing_validation',\n        },\n        'user.archive': {\n          target: 'archived',\n        },\n      },\n    },\n    pricing_validation: {\n      invoke: {\n        id: 'pricing_validator',\n        input: {\n          deal_id: 'context.deal_id',\n        },\n        onDone: {\n          target: 'underwriting',\n          actions: {\n            type: 'createTask',\n            params: {\n              title: 'Ready for underwriting',\n              user_id: 238_923_892,\n              description:\n                '[deal_id] has scompleted pricing. Please review and send out the contract.',\n            },\n          },\n        },\n        onError: {\n          target: 'pricing',\n          actions: {\n            type: 'assign',\n            params: {\n              error: 'price rejected',\n            },\n          },\n        },\n        src: 'validator',\n      },\n    },\n    underwriting: {\n      on: {\n        'user.archive': {\n          target: 'archived',\n        },\n        'user.underwriting_completed': {\n          target: 'final_underwriting_approval',\n        },\n      },\n    },\n    final_underwriting_approval: {\n      on: {\n        'user.underwriting_approved': {\n          target: 'contract_out',\n          actions: {\n            type: 'sendEmail',\n            params: {\n              body: 'Your contract is ready for review.',\n              from: 'zach@gmail.com',\n              subject: 'Contract for [deal]',\n            },\n          },\n        },\n        'user.cancel': {\n          target: 'archived',\n        },\n      },\n    },\n    contract_out: {\n      on: {\n        'system.contract_recieved': {\n          target: 'contract_in',\n          actions: {\n            type: 'createTask',\n          },\n        },\n        'user.contract_recieved': {\n          target: 'contract_in',\n          actions: {\n            type: 'createTask',\n          },\n        },\n        'user.cancel': {\n          target: 'archived',\n        },\n      },\n    },\n    contract_in: {\n      on: {\n        'user.contract_verified': {\n          target: 'pre_funding',\n          actions: {\n            type: 'createTask',\n          },\n        },\n        'user.cancel': {\n          target: 'archived',\n        },\n      },\n    },\n    pre_funding: {\n      on: {\n        'user.funding_recieved': {\n          target: 'funded',\n        },\n        'user.cancel': {\n          target: 'archived',\n        },\n      },\n    },\n    funded: {\n      on: {\n        'system.completed': {\n          target: 'completed',\n        },\n        'user.cancel': {\n          target: 'archived',\n        },\n      },\n    },\n    completed: {\n      on: {\n        'user.cancel': {\n          target: 'archived',\n        },\n      },\n    },\n  },\n});\n"],"names":["setup","assign","createMachine","machine","types","context","events","actions","sendEmail","event","params","createTask","actors","validator","error","deal_id","id","initial","description","states","submission","on","target","submission_validation","invoke","input","onDone","type","onError","src","archived","pre_qualified","failed_pre_qualification","pricing","pricing_validation","title","user_id","underwriting","final_underwriting_approval","body","from","subject","contract_out","contract_in","pre_funding","funded","completed"],"mappings":"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"}