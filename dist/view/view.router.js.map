{"version":3,"sources":["../../src/view/view.router.ts"],"sourcesContent":["import { Input, Mutation, Query, Router } from 'nestjs-trpc';\nimport { z } from 'zod';\nimport { Inject } from '@nestjs/common';\n\nimport { ViewService, type ColumnEnabledRecord } from './view.service';\nimport { ViewDefinition } from './view.types';\n\nimport type { TDatabase } from '~/database/database';\n\n@Router({ alias: 'view' })\nexport class ViewRouter {\n  constructor(@Inject(ViewService) private viewService: ViewService) {}\n\n  @Query({\n    input: z.object({ name: z.string(), id: z.string() }),\n    output: ViewDefinition,\n  })\n  viewDefinition(@Input('id') id: string, @Input('name') name: string) {\n    return this.viewService.viewDefinition({ viewName: name, id });\n  }\n\n  @Mutation({\n    input: z.object({\n      rootViewName: z.string(),\n      columnEnabledRecords: z\n        .object({\n          name: z.string(),\n        })\n        .catchall(z.any())\n        .array(),\n    }),\n    output: z.literal('ok'),\n  })\n  async mutateViewsForRoles(\n    @Input('rootViewName') rootViewName: keyof TDatabase,\n    @Input('columnEnabledRecords')\n    columnEnabledRecords: ColumnEnabledRecord[]\n  ) {\n    await this.viewService.mutateRoleViews({\n      columnEnabledRecords,\n      rootViewName,\n      schema: 'foundation',\n    });\n    return 'ok';\n  }\n}\n"],"names":["Input","Mutation","Query","Router","z","Inject","ViewService","ViewDefinition","ViewRouter","constructor","viewService","viewDefinition","id","name","viewName","mutateViewsForRoles","rootViewName","columnEnabledRecords","mutateRoleViews","schema","input","object","string","output","catchall","any","array","literal","alias"],"mappings":";;;;;;;;;;;;;;AAAA,SAASA,KAAK,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,MAAM,QAAQ,cAAc;AAC7D,SAASC,CAAC,QAAQ,MAAM;AACxB,SAASC,MAAM,QAAQ,iBAAiB;AAExC,SAASC,WAAW,QAAkC,oBAAiB;AACvE,SAASC,cAAc,QAAQ,kBAAe;AAK9C,OAAO,MAAMC;IACXC,YAAY,AAA6BC,WAAwB,CAAE;aAA1BA,cAAAA;IAA2B;IAMpEC,eAAe,AAAaC,EAAU,EAAE,AAAeC,IAAY,EAAE;QACnE,OAAO,IAAI,CAACH,WAAW,CAACC,cAAc,CAAC;YAAEG,UAAUD;YAAMD;QAAG;IAC9D;IAEA,MAYMG,oBACJ,AAAuBC,YAA6B,EACpD,AACAC,oBAA2C,EAC3C;QACA,MAAM,IAAI,CAACP,WAAW,CAACQ,eAAe,CAAC;YACrCD;YACAD;YACAG,QAAQ;QACV;QACA,OAAO;IACT;AACF;;;QA/BIC,OAAOhB,EAAEiB,MAAM,CAAC;YAAER,MAAMT,EAAEkB,MAAM;YAAIV,IAAIR,EAAEkB,MAAM;QAAG;QACnDC,QAAQhB;;;;;;;;;;;;;QAORa,OAAOhB,EAAEiB,MAAM,CAAC;YACdL,cAAcZ,EAAEkB,MAAM;YACtBL,sBAAsBb,EACnBiB,MAAM,CAAC;gBACNR,MAAMT,EAAEkB,MAAM;YAChB,GACCE,QAAQ,CAACpB,EAAEqB,GAAG,IACdC,KAAK;QACV;QACAH,QAAQnB,EAAEuB,OAAO,CAAC;;;;;;;;;;;;;QAtBZC,OAAO"}